cd grub_core
 clang -E -DHAVE_CONFIG_H  -Wall -W  -DGRUB_MACHINE_PCBIOS=1 -DGRUB_MACHINE=I386_PC -m32 -msoft-float -Xclang -msoft-float -Xclang -no-implicit-float -nostdinc -isystem /usr/lib/llvm-3.8/bin/../lib/clang/3.8.0/include -I../include -I../include -DGRUB_FILE=\".include/grub/cache.h\" -I. -I. -I.. -I.. -I../include -I../include -I../grub-core/lib/libgcrypt-grub/src/   -DGRUB_KERNEL=1 -D_FILE_OFFSET_BITS=64  -DGRUB_SYMBOL_GENERATOR=1 ../include/grub/cache.h ../include/grub/command.h ../include/grub/device.h ../include/grub/disk.h ../include/grub/dl.h ../include/grub/env.h ../include/grub/env_private.h ../include/grub/err.h ../include/grub/file.h ../include/grub/fs.h ../include/grub/i18n.h ../include/grub/kernel.h ../include/grub/list.h ../include/grub/misc.h ../include/grub/compiler-rt.h ../include/grub/mm.h ../include/grub/parser.h ../include/grub/partition.h ../include/grub/term.h ../include/grub/time.h ../include/grub/mm_private.h ../include/grub/net.h ../include/grub/memory.h ../include/grub/machine/kernel.h ../include/grub/machine/pxe.h ../include/grub/machine/int.h ../include/grub/i386/tsc.h ../config.h >kernel_syms.input
cat kernel_syms.input | grep -v '^#' | sed -n \
  -e '/EXPORT_FUNC *([a-zA-Z0-9_]*)/{s/.*EXPORT_FUNC *(\([a-zA-Z0-9_]*\)).*/defined kernel '""'\1/;p;}' \
  -e '/EXPORT_VAR *([a-zA-Z0-9_]*)/{s/.*EXPORT_VAR *(\([a-zA-Z0-9_]*\)).*/defined kernel '""'\1/;p;}' \
  | sort -u >kernel_syms.lst